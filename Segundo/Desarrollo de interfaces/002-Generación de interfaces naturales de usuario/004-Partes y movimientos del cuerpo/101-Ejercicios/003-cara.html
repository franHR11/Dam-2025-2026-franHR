<!doctype html>
<html>
    <head>
        <meta charset="utf-8"/>
        <title>Reconocimiento Facial - Demo Interactivo</title>
        <style>
            canvas {
                max-width: 100%;
                height: auto;
            }
        </style>
        <!-- MediaPipe CDN -->
        <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    </head>
    <body>
        <video class="input_video" autoplay playsinline muted style="display: none"></video>
        <canvas class="output_canvas" width="640" height="480"></canvas>

        <script>
            const video = document.querySelector('.input_video');
            const canvas = document.querySelector('.output_canvas');
            const ctx = canvas.getContext('2d');

            function onResults(results) {
                ctx.save();
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(results.image, 0, 0, canvas.width, canvas.height);

                if (results.multiFaceLandmarks) {
                    for (const landmarks of results.multiFaceLandmarks) {
                        // Malla completa
                        drawConnectors(ctx, landmarks, FACEMESH_TESSELATION);
                        // Contornos faciales
                        drawConnectors(ctx, landmarks, FACEMESH_CONTOURS, {lineWidth: 1.5});
                        // Iris opcional
                        if (window.FACEMESH_IRISES)
                            drawConnectors(ctx, landmarks, FACEMESH_IRISES, {lineWidth: 1.5});
                    }
                }
                ctx.restore();
            }

            const faceMesh = new FaceMesh({
                locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`
            });
            faceMesh.setOptions({
                maxNumFaces: 1,
                refineLandmarks: true,
                minDetectionConfidence: 0.6,
                minTrackingConfidence: 0.6
            });
            faceMesh.onResults(onResults);

            const camera = new Camera(video, {
                onFrame: async () => { await faceMesh.send({image: video}); },
                width: 640,
                height: 480
            });
            camera.start();
        </script>
    </body>
</html>

